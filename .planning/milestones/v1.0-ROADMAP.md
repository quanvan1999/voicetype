# Milestone v1.0: VoiceType MVP

**Status:** SHIPPED 2026-01-18
**Phases:** 1-4
**Total Plans:** 12

## Overview

VoiceType delivers multilingual speech-to-text dictation for macOS in four phases. Started with a non-sandboxed menu bar shell and Whisper model loading (the architecture decisions that affect everything downstream), then built audio capture and transcription as a combined pipeline, integrated global hotkeys and text insertion for the complete user flow, and finished with settings UI and history features.

Using WhisperKit with generic Whisper "small" model (multilingual) instead of PhoWhisper. Supports both Vietnamese and English.

## Phases

### Phase 1: Foundation

**Goal**: App runs as menu bar app with correct architecture (non-sandboxed) and can load Whisper model
**Depends on**: Nothing (first phase)
**Requirements**: APP-01, APP-02, APP-03, SET-02, SET-03
**Plans**: 2 plans

Plans:
- [x] 01-01-PLAN.md - Menu bar app shell with SwiftUI MenuBarExtra and permission handling
- [x] 01-02-PLAN.md - WhisperKit integration, Whisper model loading, login item management

**Success Criteria** (achieved):
  1. App appears in menu bar with status icon (no dock icon)
  2. App requests and handles microphone and accessibility permissions
  3. App can start on login (user-configurable)
  4. Whisper model loads successfully and persists across app launches
  5. Settings menu accessible from menu bar icon

**Details:**
- Xcode project with macOS 14+ target and non-sandboxed entitlements
- MenuBarExtra with hidden window Settings workaround
- Permission infrastructure for Microphone and Accessibility
- ModelManager with async model loading, LaunchManager with SMAppService

### Phase 2: Audio + Transcription

**Goal**: App can record audio and transcribe Vietnamese speech to text offline
**Depends on**: Phase 1
**Requirements**: REC-01, REC-02, REC-03, REC-04, REC-05, TRS-01, TRS-02, TRS-03, TRS-04, TRS-05
**Plans**: 3 plans

Plans:
- [x] 02-01-PLAN.md - Audio capture pipeline (AVAudioEngine, 16kHz conversion)
- [x] 02-02-PLAN.md - Recording state management and visual/audio feedback
- [x] 02-03-PLAN.md - WhisperKit integration with Whisper small model (multilingual)

**Success Criteria** (achieved):
  1. App captures audio from microphone when recording is triggered
  2. Visual indicator shows recording state (menu bar icon change + floating indicator)
  3. Audio feedback plays on recording start and stop
  4. Speech is transcribed to text (Whisper multilingual - supports Vietnamese and English)
  5. Transcription works 100% offline with punctuation and paragraph breaks

**Details:**
- AudioRecorder with AVAudioEngine and AVAudioConverter for any input device
- FloatingIndicatorPanel (NSPanel) visible in fullscreen apps
- AudioFeedback with NSSound for recording sounds
- TranscriptionService orchestrating record â†’ transcribe flow
- WhisperKit with Vietnamese language explicitly set

### Phase 3: System Integration

**Goal**: User can trigger recording with global hotkey and have text inserted at cursor
**Depends on**: Phase 2
**Requirements**: ACT-01, ACT-02, ACT-03, ACT-04, OUT-01, OUT-02, OUT-03
**Plans**: 2 plans

Plans:
- [x] 03-01-PLAN.md - HotkeyService (KeyboardShortcuts, hold-to-talk/toggle) + TextInsertionService (AX + clipboard)
- [x] 03-02-PLAN.md - Integration wiring (hotkey->recording, transcription->insertion) + Settings UI

**Success Criteria** (achieved):
  1. User can hold hotkey to record, release to transcribe (hold-to-talk mode)
  2. User can toggle recording on/off with hotkey (toggle mode)
  3. Global hotkey works from any app
  4. User can configure custom hotkey
  5. Transcribed text is inserted at cursor in any macOS app (with clipboard fallback)

**Details:**
- KeyboardShortcuts v2.0 SPM package
- Option+Space as default hotkey
- Dual insertion strategy: AX first, clipboard+paste fallback
- Mode persistence via UserDefaults

### Phase 4: Polish

**Goal**: User can configure model size, switch languages, and view transcription history
**Depends on**: Phase 3
**Requirements**: SET-01, HST-01, HST-02, HST-03
**Plans**: 5 plans

Plans:
- [x] 04-01-PLAN.md - Language mode selection (Auto/Vietnamese/English) + cycle hotkey (Option+L)
- [x] 04-02-PLAN.md - Status feedback UI (recording, transcribing, downloading, error states)
- [x] 04-03-PLAN.md - Model size selection (tiny/base/small/medium/large) with download progress
- [x] 04-04-PLAN.md - Transcription history storage and viewing with SwiftData
- [x] 04-05-PLAN.md - UAT gap closure: model download race condition + History tab icon

**Success Criteria** (achieved):
  1. User can choose between Whisper model sizes (tiny/base/small/medium/large)
  2. User can switch language mode with hotkey (Auto/Vietnamese/English)
  3. Status feedback shown when blocked (downloading model, transcribing, etc.)
  4. App stores recent transcriptions
  5. User can view and copy text from transcription history

**Details:**
- LanguageMode enum with whisperLanguageCode property
- StatusIndicatorPanel with SF Symbols for all states
- WhisperModel struct with 5 size options
- SwiftData @Model for TranscriptionRecord with 100-item limit
- TabView in Settings for General/History tabs

---

## Milestone Summary

**Key Decisions:**

- Non-sandboxed distribution (Accessibility API, CGEventTap require it)
- WhisperKit over SwiftWhisper (CoreML optimization, auto model download)
- Whisper multilingual (supports both Vietnamese + English)
- NSSound over AudioServicesPlaySystemSound (iOS IDs don't work on macOS)
- Pure AppKit FloatingIndicatorPanel (SwiftUI NSHostingView caused crashes)
- Dual text insertion (AX + clipboard fallback)
- SwiftData for history (modern Apple framework)
- UserDefaults over @AppStorage (avoids @Observable conflict)

**Issues Resolved:**

- FloatingIndicatorPanel crash fixed by switching to pure AppKit
- Audio feedback fixed by using NSSound instead of AudioToolbox
- State stuck after recording fixed by auto-reset from terminal states
- Model download race condition fixed via computed Binding
- History tab icon visibility fixed via explicit TabView tags

**Technical Debt Incurred:**

- HotkeyService has separate statusPanel instance (acceptable for UI isolation)
- Using Whisper multilingual instead of PhoWhisper (lower Vietnamese accuracy but dual-language support)

---

_For current project status, see .planning/PROJECT.md_
